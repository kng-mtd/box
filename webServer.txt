https://chatgpt.com/c/67b4e2a5-8e5c-800c-9ca4-da6424d3afb4

Node.js ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã—ã¦ã€HTMX + Alpine.js ã® Web ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹å ´åˆã€åŸºæœ¬çš„ãªæ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  

1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (HTML, Alpine.js, HTMX)**  
   - HTMX ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã—ã€HTML ã‚’éƒ¨åˆ†æ›´æ–°  
   - Alpine.js ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª UI ã‚’å®Ÿè£…  
2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Node.js + Express)**  
   - HTMX ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦ HTML ã‚’è¿”ã™ API ã‚’æä¾›  

---

## **ğŸ“Œ å¿…è¦ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
ã¾ãšã€Node.js ã®ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã€Express ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚Šã¾ã™ã€‚  

```sh
mkdir htmx-alpine-node
cd htmx-alpine-node
npm init -y
npm install express
```

---

## **ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Express ã‚µãƒ¼ãƒãƒ¼ (server.js)**  
`server.js` ã‚’ä½œæˆã—ã¦ã€HTMX ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« HTML ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚  

```javascript
const express = require("express");
const app = express();
const port = 3000;

app.use(express.static("public")); // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æä¾›

// HTMX ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œç­”ã™ã‚‹ãƒ«ãƒ¼ãƒˆ
app.get("/hello", (req, res) => {
    res.send("<p>ã“ã‚“ã«ã¡ã¯ï¼HTMX ã§ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚</p>");
});

app.listen(port, () => {
    console.log(`Server is running at http://localhost:${port}`);
});
```

---

## **ğŸ–¥ï¸ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: HTMX + Alpine.js (public/index.html)**
HTMX ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ HTML ã‚’å–å¾—ã—ã€Alpine.js ã§ UI ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMX + Alpine.js + Node.js</title>
    <script src="https://unpkg.com/htmx.org"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>HTMX + Alpine.js + Node.js ã®ã‚µãƒ³ãƒ—ãƒ«</h1>

    <!-- HTMX ã‚’ä½¿ã£ãŸã‚µãƒ¼ãƒãƒ¼é€šä¿¡ -->
    <button hx-get="/hello" hx-target="#response">
        ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
    </button>
    <div id="response"></div>

    <!-- Alpine.js ã‚’ä½¿ã£ãŸã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div x-data="{ open: false }">
        <button @click="open = !open">è©³ç´°ã‚’è¡¨ç¤º</button>
        <p x-show="open" class="hidden">ã“ã“ã«è©³ç´°æƒ…å ±ãŒã‚ã‚Šã¾ã™ã€‚</p>
    </div>

</body>
</html>
```

---

## **ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
ä½œæˆã—ãŸ `server.js` ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚  

```sh
node server.js
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:3000](http://localhost:3000) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã°ã€  
HTMX ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€Alpine.js ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ Web ãƒšãƒ¼ã‚¸ãŒå‹•ä½œã—ã¾ã™ï¼ ğŸš€  

---

## **ğŸ”¹ æ‹¡å¼µæ¡ˆ**
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº (MongoDB, PostgreSQL, MySQL)**
- **HTMX ã® WebSocket æ‹¡å¼µã‚’ä½¿ã£ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**
- **ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç† (HTMX ã® `hx-post`)**
- **Alpine.js ã§ãƒªãƒƒãƒãª UI (ãƒ¢ãƒ¼ãƒ€ãƒ«ã€ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã€ã‚¿ãƒ– UI)**



Node.js + Express ã« **Basic èªè¨¼** ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚  
Basic èªè¨¼ã‚’è¿½åŠ ã™ã‚‹ã¨ã€æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ãªã„ã¨ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã™ã€‚  

---

## **ğŸ“Œ æ‰‹é †**
1. **Basic èªè¨¼ç”¨ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½œæˆ**
2. **Express ã«é©ç”¨**
3. **ä¿è­·ã—ãŸã„ãƒ«ãƒ¼ãƒˆã«èªè¨¼ã‚’é©ç”¨**

---

## **ğŸ”§ ã‚µãƒ¼ãƒãƒ¼ (server.js)**
Basic èªè¨¼ã‚’ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦å®Ÿè£…ã—ã€ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚’ä¿è­·ã—ã¾ã™ã€‚  

```javascript
const express = require("express");

const app = express();
const port = 3000;

// Basic èªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
const USERNAME = "admin";
const PASSWORD = "password";

// Basic èªè¨¼ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
const basicAuth = (req, res, next) => {
    const authHeader = req.headers.authorization;

    // èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ãŒãªã„å ´åˆ
    if (!authHeader || !authHeader.startsWith("Basic ")) {
        res.set("WWW-Authenticate", 'Basic realm="Restricted"');
        return res.status(401).send("èªè¨¼ãŒå¿…è¦ã§ã™");
    }

    try {
        const encoded = authHeader.split(" ")[1];
        const decoded = Buffer.from(encoded, "base64").toString("utf-8");

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—
        const credentials = decoded.split(":");
        if (credentials.length !== 2) {
            throw new Error("Invalid auth format");
        }

        const [user, pass] = credentials;

        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        if (user === USERNAME && pass === PASSWORD) {
            return next(); // èªè¨¼æˆåŠŸ
        }
    } catch (error) {
        console.error("Basic èªè¨¼ã‚¨ãƒ©ãƒ¼:", error.message);
    }

    // èªè¨¼å¤±æ•—æ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    res.set("WWW-Authenticate", 'Basic realm="Restricted"');
    return res.status(401).send("èªè¨¼å¤±æ•—");
};


// Basic èªè¨¼ã‚’é©ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒˆ
app.use(basicAuth);

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ« (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰) ã‚’æä¾›
app.use(express.static("public"));

// HTMX ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.get("/hello", (req, res) => {
    res.send("<p>ã“ã‚“ã«ã¡ã¯ï¼HTMX ã§ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚</p>");
});

app.listen(port, () => {
    console.log(`Server is running at http://localhost:${port}`);
});
```

---

## **ğŸ–¥ï¸ å‹•ä½œç¢ºèª**
1. `node server.js` ã‚’å®Ÿè¡Œ
2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:3000](http://localhost:3000) ã«ã‚¢ã‚¯ã‚»ã‚¹  
3. Basic èªè¨¼ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼å: `admin`**, **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: `password`** ã‚’å…¥åŠ›  
5. èªè¨¼ãŒæˆåŠŸã™ã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ ğŸ‰  

---

## **ğŸ”¹ æ”¹è‰¯ãƒã‚¤ãƒ³ãƒˆ**
1. **`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦èªè¨¼æƒ…å ±ã‚’ç®¡ç†**ï¼ˆ`dotenv` ã‚’åˆ©ç”¨ï¼‰
2. **ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ã¿ã« Basic èªè¨¼ã‚’é©ç”¨**ï¼ˆ`app.use(basicAuth);` ã®ä»£ã‚ã‚Šã« `app.get("/protected", basicAuth, handler)` ï¼‰
3. **ã‚ˆã‚Šå®‰å…¨ãªèªè¨¼æ–¹å¼ã«ã™ã‚‹**ï¼ˆJWT, ã‚»ãƒƒã‚·ãƒ§ãƒ³èªè¨¼ãªã©ï¼‰

---

ã“ã® `basicAuth` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯ã€**Node.js + Express** ã§ **Basic èªè¨¼** ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®é–¢æ•°ã§ã™ã€‚  
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® `Authorization` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è§£æã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚  

---

## **ğŸ“Œ ã‚³ãƒ¼ãƒ‰ã®è©³ç´°ãªè§£èª¬**
```javascript
const basicAuth = (req, res, next) => {
```
- Express ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é–¢æ•°ã‚’å®šç¾©  
- `req`ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰, `res`ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰, `next`ï¼ˆæ¬¡ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å‘¼ã³å‡ºã™é–¢æ•°ï¼‰ã‚’å—ã‘å–ã‚‹  

---

### **1ï¸âƒ£ Authorization ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª**
```javascript
const authHeader = req.headers.authorization;
```
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãªã©ï¼‰ãŒé€ä¿¡ã™ã‚‹ **`Authorization` ãƒ˜ãƒƒãƒ€ãƒ¼** ã‚’å–å¾—  

```javascript
if (!authHeader || !authHeader.startsWith("Basic ")) {
    res.set("WWW-Authenticate", 'Basic realm="Restricted"');
    return res.status(401).send("èªè¨¼ãŒå¿…è¦ã§ã™");
}
```
- `authHeader` ãŒå­˜åœ¨ã—ãªã„ or `"Basic "` ã§å§‹ã¾ã‚‰ãªã„å ´åˆã€èªè¨¼ã‚’è¦æ±‚ã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™  
- **`WWW-Authenticate` ãƒ˜ãƒƒãƒ€ãƒ¼** ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯ **Basic èªè¨¼ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ€ã‚¤ã‚¢ãƒ­ã‚°** ã‚’è¡¨ç¤ºã™ã‚‹  

---

### **2ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è§£æ**
```javascript
try {
    const encoded = authHeader.split(" ")[1]; // "Basic xxxxxxx" ã® "xxxxx" ã‚’å–å¾—
    const decoded = Buffer.from(encoded, "base64").toString("utf-8");
```
- `authHeader` ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ `"Basic dXNlcm5hbWU6cGFzc3dvcmQ="`ï¼ˆBase64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ï¼‰  
- `"Basic "` ã®å¾Œã‚ã®éƒ¨åˆ† (`dXNlcm5hbWU6cGFzc3dvcmQ=`) ã‚’å–ã‚Šå‡ºã—ã€Base64 ã§ãƒ‡ã‚³ãƒ¼ãƒ‰  
- ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã® `decoded` ã®ä¸­èº«ã¯ `"username:password"` ã«ãªã‚‹  

---

### **3ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèª**
```javascript
const credentials = decoded.split(":");
if (credentials.length !== 2) {
    throw new Error("Invalid auth format");
}

const [user, pass] = credentials;
```
- `":"` ã§åˆ†å‰²ã—ã€`["username", "password"]` ã®å½¢ã«ãªã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯  
- `credentials.length !== 2` ã®å ´åˆã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé–“é•ã£ã¦ã„ã‚‹ãŸã‚ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼  

---

### **4ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®èªè¨¼**
```javascript
if (user === USERNAME && pass === PASSWORD) {
    return next(); // èªè¨¼æˆåŠŸ â†’ æ¬¡ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¸
}
```
- äº‹å‰ã«å®šç¾©ã—ãŸ `USERNAME` ã¨ `PASSWORD`ï¼ˆä¾‹: `"admin"` ã¨ `"password"`) ã¨æ¯”è¼ƒ  
- **ä¸€è‡´ã™ã‚Œã° `next()` ã‚’å‘¼ã³å‡ºã—ã€å‡¦ç†ã‚’æ¬¡ã«é€²ã‚ã‚‹**ï¼ˆãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ï¼‰  

---

### **5ï¸âƒ£ èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†**
```javascript
} catch (error) {
    console.error("Basic èªè¨¼ã‚¨ãƒ©ãƒ¼:", error.message);
}
```
- `Base64` ã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã‚„ `split(":")` ã®å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€**ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’å‡ºåŠ›**  
- ä¾‹ãˆã°ã€`authHeader.split(" ")[1]` ãŒ `undefined` ã ã¨ `Buffer.from(undefined, "base64")` ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹  

```javascript
res.set("WWW-Authenticate", 'Basic realm="Restricted"');
return res.status(401).send("èªè¨¼å¤±æ•—");
```
- èªè¨¼ã«å¤±æ•—ã—ãŸå ´åˆã€`401 Unauthorized` ã‚’è¿”ã™  
- **`WWW-Authenticate` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒå†ã³èªè¨¼ã‚’æ±‚ã‚ã‚‹**  

---

## **ğŸ“Œ å‡¦ç†ã®æµã‚Œ**
| ã‚¹ãƒ†ãƒƒãƒ— | èª¬æ˜ |
|---------|------|
| â‘  `Authorization` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å–å¾— | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® `Authorization` ã‚’å–å¾— |
| â‘¡ ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¢ºèª | `"Basic "` ã§å§‹ã¾ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ |
| â‘¢ Base64 ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ | `"username:password"` ã®å½¢å¼ã«å¤‰æ› |
| â‘£ ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º | `":"` ã§åˆ†å‰²ã—ã€é…åˆ— `["user", "pass"]` ã‚’å–å¾— |
| â‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒ | ä¸€è‡´ã™ã‚Œã° `next()` ã‚’å®Ÿè¡Œ |
| â‘¥ èªè¨¼å¤±æ•—æ™‚ã®å‡¦ç† | `401 Unauthorized` ã‚’è¿”ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ |

---

## **ğŸ›  å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**
âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¼·åŒ–** â†’ `try-catch` ã‚’ä½¿ã„ã€ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é©åˆ‡ã«å‡¦ç†  
âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è€ƒæ…®** â†’ `split(":")` ã®ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ­£ã—ã„ã‹ç¢ºèª  
âœ… **ãƒ–ãƒ©ã‚¦ã‚¶ã®å†èªè¨¼ã‚’ä¿ƒã™** â†’ `WWW-Authenticate` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã—ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å†è¡¨ç¤º  

---


## **1ï¸âƒ£ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦èªè¨¼æƒ…å ±ã‚’ç®¡ç†ï¼ˆ`dotenv` ã‚’åˆ©ç”¨ï¼‰**  

ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«èªè¨¼æƒ…å ±ã‚’ç›´æ¥æ›¸ã‹ãšã«ç®¡ç†** ã§ãã¾ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š & è¨­å®šã®å¤‰æ›´ãŒç°¡å˜** ã«ãªã‚Šã¾ã™ã€‚  

### **ğŸ“Œ æ‰‹é †**
1. **`dotenv` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
2. **`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€èªè¨¼æƒ…å ±ã‚’å®šç¾©**
3. **`dotenv` ã‚’ä½¿ã£ã¦ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€**

---

### **ğŸ”§ `dotenv` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
ã¾ãšã€`dotenv` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

```sh
npm install dotenv
```

---

### **ğŸ“„ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ**
ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«èªè¨¼æƒ…å ±ã‚’è¨˜è¿°ã—ã¾ã™ã€‚  

```ini
BASIC_AUTH_USER=admin
BASIC_AUTH_PASS=password
```

**âš  `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«è¿½åŠ ã™ã‚‹ï¼**
```ini
# .gitignore
.env
```
ã“ã†ã™ã‚‹ã“ã¨ã§ã€GitHub ãªã©ã« **èªè¨¼æƒ…å ±ã‚’èª¤ã£ã¦å…¬é–‹ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’é˜²ã’ã‚‹** ï¼

---

### **ğŸ“ `server.js` ã‚’ä¿®æ­£**
ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚  

```javascript
require("dotenv").config(); // dotenv ã‚’èª­ã¿è¾¼ã‚€
const express = require("express");

const app = express();
const port = 3000;

// .env ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å–å¾—
const USERNAME = process.env.BASIC_AUTH_USER;
const PASSWORD = process.env.BASIC_AUTH_PASS;

const basicAuth = (req, res, next) => {
    const authHeader = req.headers.authorization;

    if (!authHeader || !authHeader.startsWith("Basic ")) {
        res.set("WWW-Authenticate", 'Basic realm="Restricted"');
        return res.status(401).send("èªè¨¼ãŒå¿…è¦ã§ã™");
    }

    try {
        const encoded = authHeader.split(" ")[1];
        const decoded = Buffer.from(encoded, "base64").toString("utf-8");

        const credentials = decoded.split(":");
        if (credentials.length !== 2) {
            throw new Error("Invalid auth format");
        }

        const [user, pass] = credentials;

        if (user === USERNAME && pass === PASSWORD) {
            return next(); // èªè¨¼æˆåŠŸ
        }
    } catch (error) {
        console.error("Basic èªè¨¼ã‚¨ãƒ©ãƒ¼:", error.message);
    }

    res.set("WWW-Authenticate", 'Basic realm="Restricted"');
    return res.status(401).send("èªè¨¼å¤±æ•—");
};

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æä¾›
app.use(express.static("public"));

// HTMX ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.get("/hello", (req, res) => {
    res.send("<p>ã“ã‚“ã«ã¡ã¯ï¼HTMX ã§ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚</p>");
});

app.listen(port, () => {
    console.log(`Server is running at http://localhost:${port}`);
});
```

**âœ… ã“ã‚Œã§ `.env` ã«è¨˜è¿°ã—ãŸèªè¨¼æƒ…å ±ã‚’èª­ã¿è¾¼ã‚ã‚‹ï¼**  

---

## **2ï¸âƒ£ ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ã¿ã« Basic èªè¨¼ã‚’é©ç”¨**  

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€**ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« Basic èªè¨¼ã‚’é©ç”¨** ã—ã¦ã„ã¾ã™ã€‚  
ã—ã‹ã—ã€`app.use(basicAuth);` ã‚’å‰Šé™¤ã—ã€**ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã ã‘ã«é©ç”¨** ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  

---

### **ğŸ“ ä¿®æ­£å¾Œã® `server.js`**
```javascript
// `/protected` ãƒ«ãƒ¼ãƒˆã ã‘ Basic èªè¨¼ã‚’é©ç”¨
app.get("/protected", basicAuth, (req, res) => {
    res.send("<h2>ã“ã®ãƒšãƒ¼ã‚¸ã¯èªè¨¼ãŒå¿…è¦ã§ã™ï¼</h2>");
});
```

### **ğŸ“Œ å¤‰æ›´ç‚¹**
- `app.use(basicAuth);` â†’ **å‰Šé™¤**
- `app.get("/protected", basicAuth, handler);` â†’ **ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã ã‘ã«èªè¨¼ã‚’é©ç”¨**

---

### **ğŸš€ å‹•ä½œç¢ºèª**
1. `/protected` ã«ã‚¢ã‚¯ã‚»ã‚¹: **èªè¨¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤º**
   ```sh
   http://localhost:3000/protected
   ```
2. `/hello` ã«ã‚¢ã‚¯ã‚»ã‚¹: **èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**
   ```sh
   http://localhost:3000/hello
   ```

---


## **ğŸ“Œ æ¦‚è¦**
Node.jsï¼ˆExpressï¼‰+ HTMX + SQLite ã‚’ä½¿ã£ã¦ã€**CRUDï¼ˆCreate, Read, Update, Deleteï¼‰** ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚  
HTMX ã‚’ä½¿ã†ã“ã¨ã§ã€**ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã›ãšã«å‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œ** ã§ãã¾ã™ã€‚  

---

## **ğŸ›  ä½¿ç”¨ã™ã‚‹æŠ€è¡“**
âœ… **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:** HTMXï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªå‹•çš„ãƒšãƒ¼ã‚¸æ“ä½œï¼‰  
âœ… **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:** Expressï¼ˆNode.js ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰  
âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:** SQLite3ï¼ˆè»½é‡ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰  
âœ… **ORM:** `better-sqlite3`ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§é€Ÿã„ SQLite ã®ãƒ©ãƒƒãƒ‘ãƒ¼ï¼‰  

---

## **ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ**
```
project/
â”‚â”€â”€ public/          # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTML, CSS, JSï¼‰
â”‚â”€â”€ views/           # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆEJSï¼‰
â”‚â”€â”€ db.sqlite        # SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
â”‚â”€â”€ server.js        # ãƒ¡ã‚¤ãƒ³ã®ã‚µãƒ¼ãƒãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚â”€â”€ package.json     # npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±
â”‚â”€â”€ .env             # ç’°å¢ƒå¤‰æ•°
```

---

## **ğŸ“Œ 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
### **â‘  å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```sh
npm init -y
npm install express htmx.org ejs dotenv better-sqlite3
```

### **â‘¡ SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ**
```sh
touch db.sqlite
```

---

## **ğŸ“Œ 2. `server.js`ï¼ˆExpress + SQLite ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰**
```javascript
require("dotenv").config();
const express = require("express");
const Database = require("better-sqlite3");
const path = require("path");

const app = express();
const port = 3000;
const db = new Database("db.sqlite");

// ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
db.prepare(`
    CREATE TABLE IF NOT EXISTS items (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL
    )
`).run();

// ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
app.use(express.urlencoded({ extended: true }));
app.use(express.static("public"));
app.set("view engine", "ejs");

// **ğŸ“Œ Read (ä¸€è¦§è¡¨ç¤º)**
app.get("/", (req, res) => {
    const items = db.prepare("SELECT * FROM items").all();
    res.render("index", { items });
});

// **ğŸ“Œ Createï¼ˆè¿½åŠ ï¼‰**
app.post("/add", (req, res) => {
    const name = req.body.name;
    if (name.trim() !== "") {
        db.prepare("INSERT INTO items (name) VALUES (?)").run(name);
    }
    res.redirect("/"); // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
});

// **ğŸ“Œ Deleteï¼ˆå‰Šé™¤ï¼‰**
app.post("/delete/:id", (req, res) => {
    db.prepare("DELETE FROM items WHERE id = ?").run(req.params.id);
    res.redirect("/");
});

// **ğŸ“Œ Updateï¼ˆç·¨é›†ï¼‰**
app.post("/edit/:id", (req, res) => {
    const { id } = req.params;
    const { name } = req.body;
    db.prepare("UPDATE items SET name = ? WHERE id = ?").run(name, id);
    res.redirect("/");
});

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});
```

---

## **ğŸ“Œ 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆHTMX ã‚’ä½¿ã£ãŸ `views/index.ejs`ï¼‰**
`views/index.ejs` ã‚’ä½œæˆã—ã€HTMX ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã™ã€‚  

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMX + SQLite CRUD</title>
    <script src="https://unpkg.com/htmx.org@1.9.4"></script>
</head>
<body>
    <h1>SQLite CRUD with HTMX</h1>

    <!-- æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ  -->
    <form hx-post="/add" hx-target="#items" hx-swap="outerHTML">
        <input type="text" name="name" required>
        <button type="submit">è¿½åŠ </button>
    </form>

    <!-- ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ -->
    <div id="items">
        <ul>
            <% items.forEach(item => { %>
                <li id="item-<%= item.id %>">
                    <span><%= item.name %></span>
                    <button hx-delete="/delete/<%= item.id %>" hx-target="#item-<%= item.id %>" hx-swap="outerHTML">å‰Šé™¤</button>
                    <button hx-get="/edit-form/<%= item.id %>" hx-target="#item-<%= item.id %>" hx-swap="outerHTML">ç·¨é›†</button>
                </li>
            <% }); %>
        </ul>
    </div>
</body>
</html>
```

---

## **ğŸ“Œ 4. ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€**
ç·¨é›†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚  

### **ğŸ“ `server.js` ã«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ **
```javascript
// **ğŸ“Œ ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¿”ã™**
app.get("/edit-form/:id", (req, res) => {
    const item = db.prepare("SELECT * FROM items WHERE id = ?").get(req.params.id);
    res.send(`
        <form hx-post="/edit/${item.id}" hx-target="#item-${item.id}" hx-swap="outerHTML">
            <input type="text" name="name" value="${item.name}" required>
            <button type="submit">æ›´æ–°</button>
        </form>
    `);
});
```

---

## **ğŸ“Œ 5. å‹•ä½œç¢ºèª**
### **â‘  ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
```sh
node server.js
```

### **â‘¡ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**
http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ä»¥ä¸‹ã®æ“ä½œã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚  

âœ… **è¿½åŠ :** ãƒ•ã‚©ãƒ¼ãƒ ã«åå‰ã‚’å…¥åŠ› â†’ ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™  
âœ… **å‰Šé™¤:** ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ï¼ˆå³åº§ã«å‰Šé™¤ï¼‰  
âœ… **ç·¨é›†:** ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ â†’ ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã€æ›´æ–°å¯èƒ½  

---

Basic èªè¨¼ã‚’è¿½åŠ ã—ã¦ã€èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ãŒ CRUD æ“ä½œã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  
ã™ã§ã« `.env` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ãã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

---

## **ğŸ“Œ 1. `.env` ã«èªè¨¼æƒ…å ±ã‚’è¿½åŠ **
`BASIC_AUTH_USER` ã¨ `BASIC_AUTH_PASS` ã‚’è¨­å®šã—ã¾ã™ã€‚

```ini
BASIC_AUTH_USER=admin
BASIC_AUTH_PASS=password
```

**âš  `.env` ã¯ `.gitignore` ã«è¿½åŠ ã™ã‚‹ï¼**
```ini
# .gitignore
.env
```

---

## **ğŸ“Œ 2. `server.js` ã« Basic èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¿½åŠ **
ä»¥ä¸‹ã® `basicAuth` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å®šç¾©ã—ã€CRUD ã«é–¢ã‚ã‚‹ãƒ«ãƒ¼ãƒˆã¸é©ç”¨ã—ã¾ã™ã€‚

```javascript
require("dotenv").config();
const express = require("express");
const Database = require("better-sqlite3");
const path = require("path");

const app = express();
const port = 3000;
const db = new Database("db.sqlite");

// èªè¨¼æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
const USERNAME = process.env.BASIC_AUTH_USER;
const PASSWORD = process.env.BASIC_AUTH_PASS;

// **ğŸ“Œ Basic èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**
const basicAuth = (req, res, next) => {
    const authHeader = req.headers.authorization;

    if (!authHeader || !authHeader.startsWith("Basic ")) {
        res.set("WWW-Authenticate", 'Basic realm="Restricted"');
        return res.status(401).send("èªè¨¼ãŒå¿…è¦ã§ã™");
    }

    try {
        const encoded = authHeader.split(" ")[1]; // "Basic xxxx"
        const decoded = Buffer.from(encoded, "base64").toString("utf-8");
        const [user, pass] = decoded.split(":");

        if (user === USERNAME && pass === PASSWORD) {
            return next(); // èªè¨¼æˆåŠŸ
        }
    } catch (error) {
        console.error("Basic èªè¨¼ã‚¨ãƒ©ãƒ¼:", error.message);
    }

    res.set("WWW-Authenticate", 'Basic realm="Restricted"');
    return res.status(401).send("èªè¨¼å¤±æ•—");
};

// **ğŸ“Œ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**
app.use(express.urlencoded({ extended: true }));
app.use(express.static("public"));
app.set("view engine", "ejs");

// **ğŸ“Œ Basic èªè¨¼ã‚’é©ç”¨**
app.use(basicAuth);

// **ğŸ“Œ Read (ä¸€è¦§è¡¨ç¤º)**
app.get("/", (req, res) => {
    const items = db.prepare("SELECT * FROM items").all();
    res.render("index", { items });
});

// **ğŸ“Œ Createï¼ˆè¿½åŠ ï¼‰**
app.post("/add", (req, res) => {
    const name = req.body.name;
    if (name.trim() !== "") {
        db.prepare("INSERT INTO items (name) VALUES (?)").run(name);
    }
    res.redirect("/");
});

// **ğŸ“Œ Deleteï¼ˆå‰Šé™¤ï¼‰**
app.post("/delete/:id", (req, res) => {
    db.prepare("DELETE FROM items WHERE id = ?").run(req.params.id);
    res.redirect("/");
});

// **ğŸ“Œ Updateï¼ˆç·¨é›†ï¼‰**
app.post("/edit/:id", (req, res) => {
    const { id } = req.params;
    const { name } = req.body;
    db.prepare("UPDATE items SET name = ? WHERE id = ?").run(name, id);
    res.redirect("/");
});

// **ğŸ“Œ ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¿”ã™**
app.get("/edit-form/:id", (req, res) => {
    const item = db.prepare("SELECT * FROM items WHERE id = ?").get(req.params.id);
    res.send(`
        <form hx-post="/edit/${item.id}" hx-target="#item-${item.id}" hx-swap="outerHTML">
            <input type="text" name="name" value="${item.name}" required>
            <button type="submit">æ›´æ–°</button>
        </form>
    `);
});

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});
```

---

## **ğŸ“Œ 3. èªè¨¼ã®å‹•ä½œç¢ºèª**
### **â‘  ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
```sh
node server.js
```

### **â‘¡ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**
http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Basic èªè¨¼ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚  
âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**: `admin`  
âœ… **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: `password`  

---



## **ğŸ“Œ æ¦‚è¦**
- **é–²è¦§å°‚ç”¨ï¼ˆå‚ç…§ï¼‰** ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã€  
- **ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ï¼ˆä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰** ã§ãã‚‹ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åŒºåˆ¥ã™ã‚‹ã€‚  
- **2ç¨®é¡ã® Basic èªè¨¼** ã‚’è¨­å®šã—ã€ãƒ«ãƒ¼ãƒˆã”ã¨ã«é©ç”¨ã™ã‚‹ã€‚

---

## **ğŸ“Œ 1. `.env` ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿½åŠ **
`.env` ã« 2 ç¨®é¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨­å®šã™ã‚‹ã€‚

```ini
# å‚ç…§å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆRead-Onlyï¼‰
VIEW_USER=viewuser
VIEW_PASS=viewpass

# ç·¨é›†å¯èƒ½ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆCRUD æ“ä½œãŒå¯èƒ½ï¼‰
ADMIN_USER=admin
ADMIN_PASS=adminpass
```

---

## **ğŸ“Œ 2. `server.js` ã«èªè¨¼å‡¦ç†ã‚’è¿½åŠ **
**é–²è¦§å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆRead-Onlyï¼‰** ã¯ `GET /` ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚  
**ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆCRUDï¼‰** ã¯ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã‚’å®Ÿè¡Œå¯èƒ½ã€‚  

```javascript
require("dotenv").config();
const express = require("express");
const Database = require("better-sqlite3");

const app = express();
const port = 3000;
const db = new Database("db.sqlite");

// .env ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å–å¾—
const VIEW_USER = process.env.VIEW_USER;
const VIEW_PASS = process.env.VIEW_PASS;
const ADMIN_USER = process.env.ADMIN_USER;
const ADMIN_PASS = process.env.ADMIN_PASS;

// **ğŸ“Œ Basic èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆæ±ç”¨ï¼‰**
const basicAuth = (allowedUser, allowedPass) => {
    return (req, res, next) => {
        const authHeader = req.headers.authorization;
        if (!authHeader || !authHeader.startsWith("Basic ")) {
            res.set("WWW-Authenticate", 'Basic realm="Restricted"');
            return res.status(401).send("èªè¨¼ãŒå¿…è¦ã§ã™");
        }

        try {
            const encoded = authHeader.split(" ")[1];
            const decoded = Buffer.from(encoded, "base64").toString("utf-8");
            const [user, pass] = decoded.split(":");

            if (user === allowedUser && pass === allowedPass) {
                return next(); // èªè¨¼æˆåŠŸ
            }
        } catch (error) {
            console.error("Basic èªè¨¼ã‚¨ãƒ©ãƒ¼:", error.message);
        }

        res.set("WWW-Authenticate", 'Basic realm="Restricted"');
        return res.status(401).send("èªè¨¼å¤±æ•—");
    };
};

// **ğŸ“Œ é–²è¦§å°‚ç”¨ï¼ˆRead-Onlyï¼‰ãƒ«ãƒ¼ãƒˆ**
app.get("/", basicAuth(VIEW_USER, VIEW_PASS), (req, res) => {
    const items = db.prepare("SELECT * FROM items").all();
    res.render("index.ejs", { items });
});

// **ğŸ“Œ CRUD æ“ä½œç”¨ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰**
app.post("/add", basicAuth(ADMIN_USER, ADMIN_PASS), (req, res) => {
    const name = req.body.name;
    if (name.trim() !== "") {
        db.prepare("INSERT INTO items (name) VALUES (?)").run(name);
    }
    res.redirect("/");
});

app.post("/delete/:id", basicAuth(ADMIN_USER, ADMIN_PASS), (req, res) => {
    db.prepare("DELETE FROM items WHERE id = ?").run(req.params.id);
    res.redirect("/");
});

app.post("/edit/:id", basicAuth(ADMIN_USER, ADMIN_PASS), (req, res) => {
    const { id } = req.params;
    const { name } = req.body;
    db.prepare("UPDATE items SET name = ? WHERE id = ?").run(name, id);
    res.redirect("/");
});

app.get("/edit-form/:id", basicAuth(ADMIN_USER, ADMIN_PASS), (req, res) => {
    const item = db.prepare("SELECT * FROM items WHERE id = ?").get(req.params.id);
    res.send(`
        <form hx-post="/edit/${item.id}" hx-target="#item-${item.id}" hx-swap="outerHTML">
            <input type="text" name="name" value="${item.name}" required>
            <button type="submit">æ›´æ–°</button>
        </form>
    `);
});

// **ğŸ“Œ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});
```

---

## **ğŸ“Œ 3. èªè¨¼ã®å‹•ä½œç¢ºèª**
### **â‘  ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
```sh
node server.js
```

### **â‘¡ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**
- `http://localhost:3000/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€**é–²è¦§ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆviewuser/viewpassï¼‰** ã®èªè¨¼ãŒå¿…è¦ã€‚
- **ã€Œè¿½åŠ ã€ã€Œå‰Šé™¤ã€ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆadmin/adminpassï¼‰èªè¨¼ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚**

---


A `.env` file is a simple text file used to store environment variables for applications. It is commonly used in development to keep sensitive information like API keys, database credentials, and configuration settings out of the main codebase.

### Example `.env` File:
```
DATABASE_URL=mysql://user:password@localhost:3306/mydatabase
API_KEY=your_api_key_here
SECRET_KEY=supersecretpassword
PORT=3000
```

### How It Works:
1. **Keeps Secrets Safe** â€“ Instead of hardcoding sensitive data into your application, you store them in a `.env` file.
2. **Eases Configuration** â€“ Different environments (development, staging, production) can have different `.env` files without modifying the code.
3. **Used with dotenv Libraries** â€“ Many programming languages have libraries (`dotenv` in Node.js, `python-dotenv` in Python) that load `.env` variables into the environment.

### How to Use `.env` in Code:
#### **Node.js (Using `dotenv`)**
```javascript
require('dotenv').config();
console.log(process.env.API_KEY);
```

#### **Python (Using `python-dotenv`)**
```python
from dotenv import load_dotenv
import os

load_dotenv()
api_key = os.getenv("API_KEY")
print(api_key)
```

### Important Notes:
- **Do not commit `.env` files to version control** (add `.env` to `.gitignore`).
- **Use `.env.example`** to share variable names without sensitive values.
  

To use the `dotenv` library in a Node.js project, follow these steps:

### 1. Install the `dotenv` package

First, you need to install the `dotenv` package using npm:

```bash
npm install dotenv
```

### 2. Create a `.env` file

In the root of your project, create a `.env` file and add your environment variables. Here's an example of a `.env` file:

```env
DB_HOST=localhost
DB_USER=root
DB_PASS=password
PORT=3000
SECRET_KEY=mysecretkey
```

### 3. Load environment variables in your code

In your main Node.js file (for example, `app.js` or `index.js`), require the `dotenv` package at the top of your file and call the `config()` function. This will load the variables from the `.env` file into `process.env`.

```javascript
require('dotenv').config();

// Accessing environment variables
const dbHost = process.env.DB_HOST;
const dbUser = process.env.DB_USER;
const dbPass = process.env.DB_PASS;
const port = process.env.PORT;

console.log(`Database Host: ${dbHost}`);
console.log(`Server running on port: ${port}`);
```

### 4. Add `.env` to `.gitignore`

To avoid accidentally committing sensitive data, make sure to add `.env` to your `.gitignore` file:

```gitignore
.env
```

### Example Directory Structure:

```
my-project/
  â”œâ”€â”€ .env
  â”œâ”€â”€ .gitignore
  â”œâ”€â”€ app.js
  â””â”€â”€ node_modules/
```

### 5. Run Your Application

Now, when you run your Node.js application (`node app.js`), the environment variables from the `.env` file will be available through `process.env`.

```bash
node app.js
```

You should see the output similar to this:

```bash
Database Host: localhost
Server running on port: 3000
```

### Notes:
- **Sensitive data**: Avoid putting sensitive data directly in the `.env` file if it's shared or exposed. Consider using other secrets management solutions in production (like AWS Secrets Manager, or environment-specific configuration).




Cloudflare Pages ã¯é€šå¸¸é™çš„ã‚µã‚¤ãƒˆå‘ã‘ã§ã™ãŒã€**Cloudflare Pages Functions** ã‚’ä½¿ãˆã°ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚  


---

## ğŸŒŸ **æ‰‹é †ã®å…¨ä½“åƒ**  
âœ… Cloudflare Pages ç”¨ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã‚’å¤‰æ›´  
âœ… SQLite ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ãªå½¢å¼ã«ã™ã‚‹  
âœ… Cloudflare Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤  

---

## ğŸ“‚ **ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®å¤‰æ›´**

Cloudflare Pages ã¯é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `public` ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰é…ä¿¡ã—ã€  
ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ `functions` ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
project/
â”‚
â”œâ”€â”€ public/              # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTML, CSS, JSï¼‰
â”‚â”‚   â””â”€â”€ index.html
â”œâ”€â”€ functions/            # Cloudflare Pages Functions
â”‚â”‚   â””â”€â”€ [filename].js    # APIãƒ«ãƒ¼ãƒˆ
â”œâ”€â”€ db.sqlite              # SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ .env                   # ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ .gitignore
â””â”€â”€ wrangler.toml          # Cloudflareè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ› ï¸ **1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Cloudflare ç”¨ã«ä¿®æ­£**

âœ… **é™çš„ãƒ•ã‚¡ã‚¤ãƒ« â†’ `public/` ã«ç§»å‹•**  
âœ… **Express ã®ä»£ã‚ã‚Šã« Cloudflare Pages Functions ã‚’åˆ©ç”¨**

---

### ğŸ”§ **`functions/index.js`ï¼ˆãƒ¡ã‚¤ãƒ³ã®APIï¼‰**

Cloudflare Pages Functions ã¯ Express ã®ã‚ˆã†ã« `app.get`, `app.post` ã‚’ä½¿ãˆãªã„ãŸã‚ã€  
`fetch` ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ä½¿ã„ã¾ã™ã€‚

```javascript
import { Database } from 'better-sqlite3';

const db = new Database('./db.sqlite');

// Basic èªè¨¼
const basicAuth = (request, allowedUser, allowedPass) => {
    const authHeader = request.headers.get("Authorization");
    if (!authHeader || !authHeader.startsWith("Basic ")) {
        return new Response("èªè¨¼ãŒå¿…è¦ã§ã™", {
            status: 401,
            headers: { "WWW-Authenticate": 'Basic realm="Restricted"' },
        });
    }

    const credentials = atob(authHeader.split(" ")[1]).split(":");
    const [user, pass] = credentials;
    if (user !== allowedUser || pass !== allowedPass) {
        return new Response("èªè¨¼å¤±æ•—", {
            status: 401,
            headers: { "WWW-Authenticate": 'Basic realm="Restricted"' },
        });
    }
    return null; // èªè¨¼æˆåŠŸ
};

export async function onRequestGet(context) {
    // é–²è¦§å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
    const authResponse = basicAuth(context.request, "viewuser", "viewpass");
    if (authResponse) return authResponse;

    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    const items = db.prepare("SELECT * FROM items").all();
    return new Response(JSON.stringify(items), {
        headers: { "Content-Type": "application/json" },
    });
}

export async function onRequestPost(context) {
    // ç®¡ç†è€…å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
    const authResponse = basicAuth(context.request, "admin", "adminpass");
    if (authResponse) return authResponse;

    const requestData = await context.request.json();
    const { name } = requestData;

    if (name) {
        db.prepare("INSERT INTO items (name) VALUES (?)").run(name);
        return new Response("Item added successfully", { status: 201 });
    }

    return new Response("Invalid request", { status: 400 });
}
```

---

âœ… **é–²è¦§å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼:** `viewuser/viewpass`  
âœ… **ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼:** `admin/adminpass`

---

## ğŸ“¦ **2. SQLite ã‚’ Cloudflare å¯¾å¿œã«ã™ã‚‹**

ğŸ’¡ **Cloudflare Workers ã‚„ Pages Functions ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ï¼**  
ğŸ‘‰ ãªã®ã§ã€SQLite ã‚’ **`D1` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** ã«ç§»è¡Œã—ã¾ã™ã€‚

---

ğŸ”§ D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
1ï¸âƒ£ Cloudflare Dashboard ãƒ­ã‚°ã‚¤ãƒ³
2ï¸âƒ£ Workers & Pages â†’ D1 â†’ Create Database
3ï¸âƒ£ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’è¨­å®šã—ã€ç©ºã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ

ğŸ‘‰ D1 ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚„æ¥ç¶šæƒ…å ±ã‚’å–å¾—ã€‚

---

## ğŸ“ **3. wrangler.toml ã®ä½œæˆ**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `wrangler.toml` ã‚’ä½œæˆã—ã¾ã™ã€‚

```toml
name = "htmx-sqlite-crud"
compatibility_date = "2023-12-20"

[vars]
VIEW_USER = "viewuser"
VIEW_PASS = "viewpass"
ADMIN_USER = "admin"
ADMIN_PASS = "adminpass"

[[ d1_databases ]]
binding = "DB"
database_name = "your-d1-database-name"
database_id = "your-d1-database-id"
```

ğŸ‘‰ `binding` ã¯ `context.env.DB` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

---

## ğŸŒ **4. D1 ã‚’ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ**

### ğŸ”§ **`functions/index.js`ï¼ˆD1 å¯¾å¿œç‰ˆï¼‰**

```javascript
export async function onRequestGet(context) {
    // èªè¨¼
    const authResponse = basicAuth(context.request, "viewuser", "viewpass");
    if (authResponse) return authResponse;

    // D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const { results } = await context.env.DB.prepare("SELECT * FROM items").all();
    return new Response(JSON.stringify(results), {
        headers: { "Content-Type": "application/json" },
    });
}

export async function onRequestPost(context) {
    // èªè¨¼
    const authResponse = basicAuth(context.request, "admin", "adminpass");
    if (authResponse) return authResponse;

    const requestData = await context.request.json();
    const { name } = requestData;

    if (name) {
        await context.env.DB.prepare("INSERT INTO items (name) VALUES (?)").bind(name).run();
        return new Response("Item added successfully", { status: 201 });
    }

    return new Response("Invalid request", { status: 400 });
}
```

âœ… ã“ã‚Œã§ Cloudflare ã® D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ CRUD ã‚’è¡Œãˆã¾ã™ï¼

---

## ğŸš€ **5. Cloudflare Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤**

1ï¸âƒ£ **GitHub ãƒ—ãƒƒã‚·ãƒ¥**

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin <your-repo-url>
git push -u origin main
```

---

2ï¸âƒ£ **Cloudflare Pages ã§æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ**

GitHub ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã¯ä¸è¦
ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ public ã«è¨­å®š
functions ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è‡ªå‹•çš„ã«æ¤œå‡º

---

âœ… **ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼**  
ğŸ‘‰ Basic èªè¨¼ã§å‚ç…§å°‚ç”¨ & ç®¡ç†å°‚ç”¨ã®æ©Ÿèƒ½ã‚’åˆ†ã‘ã¤ã¤ã€  
ğŸ‘‰ Cloudflare D1 ã‚’ä½¿ã£ãŸ SQLite CRUD ã‚¢ãƒ—ãƒªãŒå‹•ä½œã—ã¾ã™ï¼âœ¨

---



Turso ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã€Cloudflare Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æµã‚Œã‚’èª¬æ˜ã—ã¾ã™ï¼  

---

## **ğŸŒŸ æ¦‚è¦**
âœ… **Turso**ï¼ˆSQLiteãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹DBï¼‰ã‚’ä½¿ç”¨  
âœ… **Cloudflare Pages Functions** ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å®Ÿè£…  
âœ… **HTMX** ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ§‹ç¯‰  

---

## **ğŸ“‚ 1. ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ**
```
project/
â”‚
â”œâ”€â”€ public/              # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTML, CSS, JSï¼‰
â”‚â”‚   â””â”€â”€ index.html
â”œâ”€â”€ functions/           # Cloudflare Pages Functions
â”‚â”‚   â”œâ”€â”€ index.js        # APIãƒ«ãƒ¼ãƒˆ
â”œâ”€â”€ schema.sql           # DBã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ package.json
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env                 # Tursoæ¥ç¶šæƒ…å ±
â”œâ”€â”€ wrangler.toml        # Cloudflareè¨­å®š
â””â”€â”€ README.md
```

---

## **ğŸ› ï¸ 2. Turso ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
### **â‘  Turso CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```sh
curl -sSfL https://get.tur.so/install.sh | bash
```
ã¾ãŸã¯ã€Homebrew ã‚’ä½¿ã†å ´åˆï¼š
```sh
brew install chiselstrike/tap/turso
```

---

### **â‘¡ Turso ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
```sh
turso auth signup
```
ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ï¼š
```sh
turso auth login
```

---

### **â‘¢ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ**
```sh
turso db create mydatabase
```
ğŸ‘‰ `mydatabase.turso.io` ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

---

### **â‘£ ã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨**
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã« `schema.sql` ã‚’ä½œæˆï¼š
```sql
CREATE TABLE items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL
);
```
é©ç”¨ã™ã‚‹ã«ã¯ï¼š
```sh
turso db shell mydatabase < schema.sql
```

---

### **â‘¤ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® URL ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—**
```sh
turso db tokens create mydatabase
```
ğŸ‘‰ `.env` ã«ä¿å­˜ï¼š
```ini
TURSO_DATABASE_URL=https://your-database.turso.io
TURSO_AUTH_TOKEN=your-auth-token
```

---

## **ğŸ“ 3. `functions/index.js`ï¼ˆTurso ã‚’ä½¿ã£ãŸ APIï¼‰**
Cloudflare Pages Functions ã§ã¯ `fetch` ã‚’ä½¿ã£ã¦ Turso ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ã€‚

```javascript
export async function onRequestGet(context) {
    const url = context.env.TURSO_DATABASE_URL;
    const token = context.env.TURSO_AUTH_TOKEN;

    const response = await fetch(`${url}/execute`, {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            statements: ["SELECT * FROM items;"]
        })
    });

    const data = await response.json();
    return new Response(JSON.stringify(data.results[0].rows), {
        headers: { "Content-Type": "application/json" }
    });
}

export async function onRequestPost(context) {
    const url = context.env.TURSO_DATABASE_URL;
    const token = context.env.TURSO_AUTH_TOKEN;
    const requestData = await context.request.json();
    const { name } = requestData;

    if (!name) {
        return new Response("Invalid request", { status: 400 });
    }

    await fetch(`${url}/execute`, {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            statements: [`INSERT INTO items (name) VALUES (?);`],
            args: [[name]]
        })
    });

    return new Response("Item added", { status: 201 });
}
```

---

## **ğŸ“¦ 4. `wrangler.toml` ã®è¨­å®š**
Cloudflare Pages ã§ç’°å¢ƒå¤‰æ•°ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šï¼š
```toml
name = "htmx-turso-app"
compatibility_date = "2023-12-20"

[vars]
TURSO_DATABASE_URL = "https://your-database.turso.io"
TURSO_AUTH_TOKEN = "your-auth-token"
```

---

## **ğŸš€ 5. Cloudflare Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤**
### **â‘  GitHub ã«ãƒ—ãƒƒã‚·ãƒ¥**
```sh
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin <your-repo-url>
git push -u origin main
```

### **â‘¡ Cloudflare Pages ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
1. Cloudflare Dashboard ã§ **Pages** ã‚’é–‹ã  
2. ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€â†’ GitHub ã‚’é¸æŠ  
3. `public/` ã‚’é™çš„ã‚µã‚¤ãƒˆã®ãƒ«ãƒ¼ãƒˆã¨ã—ã¦è¨­å®š  
4. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™  

---

## ğŸ‰ **å®Œæˆï¼**
ğŸ‘‰ **Turso + Cloudflare Pages ã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ CRUD ã‚¢ãƒ—ãƒªãŒå‹•ä½œï¼**  
ğŸ‘‰ **HTMX ã‚’ä½¿ã£ã¦ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ã§ãƒ‡ãƒ¼ã‚¿æ“ä½œï¼**  
ğŸ‘‰ **Basic èªè¨¼ã‚„ãã®ä»–ã® API ã‚‚ç°¡å˜ã«è¿½åŠ å¯èƒ½ï¼**  

ğŸ”¥ **ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®å‹•ä½œç¢ºèªã‚„è¿½åŠ ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚‚ã§ãã¾ã™ï¼**  
ã€Œã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€ã€Œè¿½åŠ æ©Ÿèƒ½ãŒæ¬²ã—ã„ã€ãªã©ã‚ã‚Œã°ã€æ°—è»½ã«èã„ã¦ãã ã•ã„ï¼ ğŸš€
